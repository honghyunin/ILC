# 인증과 인가

## 인증이란?

``유저가 누구인지 확인하는 절차`

## 인가란?

``유저에게 서비스를 이용할 권한을 허락하는 것``

- 누가, 언제, 무엇을 어떻게 쓰고 있는 가를 파악하기 위해 어느 서비스에서나 인증, 인가가 있다.
- 중요한 API나 공공적으로 사용되는 API도 기본적인 인증과 인가를 요구한다.

# 인증

우선 우리가 왜 인증이 필요한지 부터 생각해보도록 하자.

우리는 **인증이 왜 필요한가?**

- 정보를 첨부해 통신을 해야함
- 민감한 정보는 아니면서 일정시간 동안 유효해야함
- 도용되지 않아야함

그럼 위에 해당되는 방법들은 무엇이 있을까?

1. 아이디와 비밀번호를 같이 보낸다. / 매번 서버에서 확인을 해야하고, 그 과정에서 정보가 도용될 수 있다.
2. 시간제한이 있는 임시 아이디를 보낸다 / 아이디의 주인을 파악하기 어렵고 임시 아이디를 원래 아이디와 매핑해서 따로 저장해야하기 때문에 공간효율이 떨어짐
3. 일정 시간 동안 인가에 유효한 정보로 대체한다. / JWT(JSON WEB TOKEN)

# JWT

- 유저의 ID와 유효기간을 JSON 형태로 전달(객체)한다.

```markdown
{ "id":1,

"exp" : 2020_04_14

}
```

- http headers(주요한 내용을 넣는)에서 이용할 수 있도록 JSON(정보)을 'token'으로 만듬.
- **``'.'``**을 기준으로 3부분으로 나뉨(Header, playload, signature)
- Header와 payload는 누구나 decode 할 수 있다.
- signature는 인가된 서버(서버가 직접 발행한 토큰)만 암호화(복호화)할 수 있음
- Authorization header 부분에 같이 첨부해서 보냄. 프론트에서 Req가 있으면 저장하고 있던 토큰을 백에 첨부해서 같이 보냄.

## 유저의 비밀번호 암호화는 어떻게 해야할까?

- 유저의 데이터는 DB에 암호화하여 저장한다.(해킹 당했을 경우 유저의 데이터가 노출되기 때문)

그러므로 주로 비밀번호 암호화에는 'Bcrypt'가 쓰임. 

## Bcrypt

1. Salting : 원본 값에 '소금을 뿌리듯이' random 값을 추가하는 것
2. Key Chaining : 암호화된 해시값을 계속해서 암호화(해시)하여 저장하는 것.

# 인가

``유저가 Req를 실행할 권한 여부를 확인하는 절차``

- **JWT**를 서버가 유저 정보를 갖으므로 데이터에서 유저의 권한 정보도 읽어들임.
- 'access token'을 통해 해당 유저 정보를 얻으므로 해당 유저가 갖고 있는 권한(Permission)도 확인 가능.

## Authorization 절차

1. Authentication 절차를 통해 access token을 생성한다. access token에는 유저 정보를 확인할 수 있는 정보가 들어가 있어야 한다
2. 유저가 request를 보낼 때 access token을 첨부해서 보낸다.
3. 서버에서는 유저가 보낸 access token을 복호화 한다.
4. 복호화된 데이터를 통해 user id를 얻는다.
5. user id를 사용해서 database에서 해당 유저의 권한(Permission)을 확인한다.
6. 유저가 충분한 권한을 가지고 있으면 해당 요청을 처리한다.
7. 유저가 권한을 가지고 있지 않으면 Unauthorized Response(401) 혹은 다른 에러 코드를 보낸다.


## Reference

__[Reference](https://velog.io/@aaronddy/%EC%9D%B8%EC%A6%9DAuthentication%EA%B3%BC-%EC%9D%B8%EA%B0%80Authorization)__
