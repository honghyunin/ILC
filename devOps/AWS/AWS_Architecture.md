
우선 AWS에 대해서 EC2, S3, CodeDeploy, Route53, AMI 밖에 사용해보지 않은 내가 AWS 아키텍처를 그리기 위해 AWS 아키텍처란 무엇인지 부터 알아보고자 한다.

배경지식은 위에 나열한 것들이 전부이고 그것또한 얉게 공부했으므로 
우선 접근 방식을 단어의 각 뜻을 개별적으로 이해해보고 그 둘을 합쳐서 만들 수 있는 결과물에 대해 이해한 후 어떻게 그려야할지 이해해보고자 한다.

## AWS와 아키텍처

**AWS**는 Amazon Web Service의 약자로 아마존닷컴의 클라우드 컴퓨팅 사업부이다.

**아키텍쳐**는 대상의 구성과 동작 원리 구성 요소간의 관계 및 시스템 외부 환경과의 관계 등을 설명하는 설계도 혹은 청사진을 의미한다. 이론적인 수준에 머무르지 않고 지극히 현실적인 의미의 청사진을 만드는 것을 의미한다.

## AWS 아키텍처

그렇다면 AWS 아키텍처는 쉽게 말해 클라우드 컴퓨팅 서비스의 구성 요소간 관계 등을 설명하는 설계도, 청사진을 의미한다.

즉 AWS를 어떻게 구성할 것인가에 대한 설계도를 의미하는 것이 AWS 아키텍처이다.

## 어떻게 그려야 할까?

사실 어떻게 그려야할지는 서비스의 규모로 결정된다. 얼마만큼 사용자를 수용할 수 있을 지에 따라 비용도 사용해야할 스펙들도 천차만별이기 때문에 서비스의 규모와 환경을 고려하여 아키텍처를 그려야 한다.

## 사용자수 < 1,000
![1000.png](..%2F..%2Fimages%2F1000.png)
- **서버 선정 → EC2**
    - 업무에 적합하고, 필요 성능(IOPS)에 맞는 스토리지 선택
    - 온프레미스와 달리 인스턴스 타입 변경이 쉽기 때문에 용량 산정에 대한 고민이 불필요함
    - 241가지의 인스턴스 타입으로 대부분의 워크로드 및 비즈니스 요구에 적용 가능

- **서버 이중화 구성 → VPC**
    - 리전 내 서로 다른 가용 영역에 인스턴스를 생성함으로써 더 높은 가용성 확보

- **요청 분산 → AWS Elastic Load Balancing(ELB)**

> **※ ALB VS NLB**
> 
> 고가용성, 자동 확장을 해준다는 공통점이 있으나, ALB는 HTTP/HTTPS 를 지원하며 컨텐츠 기반 라우팅 시 사용되고, NLB는 TCP/UDP/TLS 를 지원하며 고정 IP로 인해 도메인 사용이 불가능 할 시에 유용함

- **DB 구성 → Amazon RDS**
    - Amazon Aurora, MySQL, PostgreSQL, MariaDB, SQL Server, ORACLE 중 원하는 데이터베이스를 별도 설치없이 사용 가능

> **※ Amazon Aurora**
> 
> - MySQL, PostgreSQL 호환
> - 3개의 가용 영역에 6벌 복제, 최대 15개 읽기 복제본
> - 자동 스트리지 확장 및 백업

- **사용자 인증 서비스 구현 → Amazon Cognito**
    - UI 내장
    - 구글, 페이스북 등의 계정과 연동 가능

-   **소스코드 관리 및 배포 → AWS Code 서비스**
    - AWS Cloud9 : 개발
    - AWS CodeCommit : 형상관리
    - AWS CodeBuild : 빌드
    - Third-party tooling : 테스트
    - AWS CodeDeploy : 배포
    - AWS CodePipeline : 위의 모든 과정을 통합

## 사용자수 > 1,000
![1000over.png](..%2F..%2Fimages%2F1000over.png)

- **시스템 확장 → EC2 오토 스케일링**
    - 갑자기 접속 수가 많아지는 경우를 고려해 규칙을 정해두면 EC2 수량을 자동으로 조절
    - 최소 수량을 설정해두면 특정 임계치에 도달 시 설정 수량만큼 기동

- **DB 가용성 확보 → Amazon RDS 다중 AZ 배포**
    - 한 가용영역에 Master, 다른 가용영역에 Stand by 생성
    - Master의 데이터를 Stand by에 복제 후 동기화
    - Master 장애 시, Stand by를 Master로 자동 승격하여 대체

- **백업 관리 → AWS Backup**
    - 백업 데이터 수명 관리 정책을 설정하여 자동 백업
    - AWS Storage Gateway 서비스와 함께 사용시, 온프레미스 데이터를 AWS로 백업
    - 백업 데이터 암호화

- **모니터링 → CloudWatch**
    - AWS 서비스별 주요 지표 데이터 수집
    - 조건에 따른 Alarm 수행
    - 여러 리전에 구성된 리소스들을 Dashboard를 통해 단일 모니터링 뷰로 확인

## 사용자수 > 10,000

![1000under.png](..%2F..%2Fimages%2F1000under.png)
- 사용자가 리소스 요청을 보낼 시, 사용자와 가까운 PoP에 먼저 전달
- 캐시에 저장해두어 동일한 리소스 요청이 올 경우, 캐시에 둔 데이터로 직접 응답
- 오리진 측 부하 감소 및 엔드 유저 latency 감소

- **부하 분산 → RDS**

![RDS.png](..%2F..%2Fimages%2FRDS.png)
**※ Amazon Aurora 읽기 복제본 오토스케일링**

- 읽기 복제본을 사용하여 평균 CPU 사용률, 평균 커넥션 수를 기준으로 오토 스케일링 되도록 구성
- 단일 END-POINT로 제공 되기 때문에 읽기 복제본이 여러 개라도 어플리케이션 분산에 대한 문제 해결

- **Amazon ElastiCache**

![AEC.png](..%2F..%2Fimages%2FAEC.png)

- 캐시 클러스터를 쉽게 구성할 수 있도록 해주는 서비스
- 1밀리초 미만의 응답 속도와 다양한 Usecase에서 활용 가능한 이점이 있음
- 빈번하게 액세스하는 데이터의 경우, DB보다 캐시 서버를 구성해 더 빠른 응답이 필요
- EC2 오토스케일링을 적용할 경우, HTTP 세션 데이터를 개별 EC2 메모리에 저장하는 것보다는 캐시 서버를 따로 구성하는 것이 나음

## 사용자수 > 100,000
![10000over.png](..%2F..%2Fimages%2F10000over.png)
- **Loosely Coupled → Amazon SQS, Amazon SNS**
    - SQS는 producer가 메시지를 큐에 넣으면 consumer가 pull방식으로 꺼내오는 서비스
    - SNS는 producer가 토픽에 메시지를 게시하면 해당 토픽을 구독하는 여러 대상으로 SNS가 푸시 방식으로 전달

- **서버리스, 이벤트 기반 아키텍처 → AWS Lambda**
    - 서버를 미리 프로비저닝하거나 관리하지 않더라도 요청에 따라 리소스가 자동적으로 스케일링

- **분산 아키텍처**
![dispersion.png](..%2F..%2Fimages%2Fdispersion.png)

- 용도에 맞는 DB 서비스 사용
    - 특정 데이터를 Data warehouse에 넣어 분석해야 할 때, 서버 A에서 put 하면 서버 B에서 꺼내 Redshift로 적재
    - 사용자가 DynamoDB에서 데이터를 조회할 경우, API Gateway에서 요청해 Lambda에서 분산 처리

- **분산 시스템 모니터링 → AWS X-Ray** 
    - 분산 어플리케이션 분석, 디버깅
    - 요청이 어플리케이션을 통과하는 전체 과정을 추적해서 서비스 전체 맵 제공
    - 사용자는 수집된 데이터로 어느 쪽에서 병목이 발생하는 지 확인
