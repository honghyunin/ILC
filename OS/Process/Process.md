# TL;DR

1. 프로세스는 프로그램이 실행된 것이다
2. 스레드는 한 프로세스 내에서 나뉘어진 하나 이상의 실행 단위이다
3. 한 어플리케이션에 대한 작업을 동시에 하기 위해서는 2가지 처리 방식(멀티 프로세스, 멀티 스레드)이 있다.
4. 동시에 실행되는 것처럼 보이기 위해서 실행 단위는 시분할로 CPU를 점유하며 이를 context switching을 한다
5. 멀티 프로세스는 독립적인 메모리를 가지고 있지만 멀티 스레드는 자원을 공유한다. 그것에 따른 각각의 장단점이 있다
6. 멀티 코어는 하드웨어 측면에서 실행 단위를 병렬적으로 처리할 수 있도록 여러 프로세서가 있는 것이다

# 테코톡 프로세스 VS 스레드

# 키워드

1. 실행 단위 - cpu core에서 실행하는 **하나의 단위**로 프로세스와 스레드를 포괄하는 개념
2. (부연 설명이 없는) 프로세스 - 하나의 스레드만 가지고 있는 **단일 스레드 프로세스**
3. 동시성 - 한 순간에 여러가지 일이 아니라, 짧은 전환으로 여**러가지 일을 동시에 처리하는 것처럼 보이는 것**

- 스레드와 프로세스는 완전히 다른 것이 아니다. 차이점은 존재하나 전혀 다른 개념은 아니다

# 1. Process & Thread

코드 파일은 피자 레시피에 비유할 수 있습니다

피자 레시피를 통해 피자를 만들면 “피자”라는 결과가 나오고

코드 파일을 실행하면 마찬가지로 “결과”가 나오게 됩니다

하지만 레시피도 코드파일도 피자를 만들거나, 실행하지 않으면 그저 파일과 종이 쪼가리일 뿐입니다

피자를 만들기 위해서는 피자 레시피를 통해 피자를 만들어줄 사람이 필요합니다

프로그램에서는 이 사람이 “프로세스” 역할을 해줍니다

## 프로세스

프로세스가 작동하려면 프로세스가 필요로 하는 재료들이 메모리에 올라가야 합니다

![process.png](..%2F..%2Fimages%2Fprocess.png)

메모리는 위 사진과 같이 4가지 영역으로 나누어져 있습니다

실행 명령을 포함하는 **코드 영역**

동적 메모리를 위한 **힙 영역**

static이나 글로벌 변수를 담는 **데이터 영역**

지역변수 매개변수 반환 값 등등 일시적인 데이터를 담은 **스택 영역**

![process_control_block.png](..%2F..%2Fimages%2Fprocess_control_block.png)

**포인터** : 프로세스 상태 중에 준비 상태나 대기 상태의 큐를 구현하기 위해 필요

Process State : 현 프로세스 상태

PID : 고유번호

Program Counter : 명령어

## Process & Thread

평소에 코딩을 할 떄를 생각해봅시다

저는 유튜브 뮤직으로 제가 자주 듣는 플레이리스트를 일단 틀어놓습니다. 이후에 코딩 할 Intellij 도 켜놓구요, 구글링을 위한 Whale, 연락을 위한 Discord, Kakaotalk을 켜둡니다

![daily.png](..%2F..%2Fimages%2Fdaily.png)

이렇게 대부분의 사람들은 하나의 프로세스만을 사용하기보다는 여러 가지를 도잇에 하고 싶어 합니다.

하지만 원래 한 프로세스가 실행 되기 위해서 cpu를 점유하고 있으면 다른 프로세스는 실행 상태에 있을 수가 없어요

노래를 듣다가 코딩을 하기 위해서 인텔리제이를 키면 노래가 꺼지게 되는 거죠

그래서 다수의 프로세스를 동시에 실행하기 위해 여러 개 프로세스를 시분할로, 즉 짧은 텀을 반복하면서 전환해서 실행을 시키도록 합니다(이게 동시성)

좀 더 자세히 들여다보죠.

여러 가지 동시 실행을하고 싶은 프로세스 두 개가 있어요

![process_1.png](..%2F..%2Fimages%2Fprocess_1.png)

이를 동시에 실행하기 위해서 다음이 짧은 텀으로 반복되어야 합니다

![process_2.png](..%2F..%2Fimages%2Fprocess_2.png)

프로세스 1이 실행상태에 있고 CPU에 적재되어 있죠

이 때 프로세스2는 준비상태에 있습니다

그리고 프로세스2를 실행하기 위해서 프로세스1이 먼저 준비상태로 내려가고

다시 1로 전환하기 위해서는 2가 준비상태로 내려가게 됩니다 이게 바로 컨텍스트 스위칭입니다

지금 단 두개의 프로세스의 컨텍스트 스위칭을 봤는데도 굉장히 피곤하고 힘든 작업이죠

스레드가 경량화된 프로세스라고 불리는 이유는 하나의 프로세스 안에 다수의 스레드가 있을 때

![process_3.png](..%2F..%2Fimages%2Fprocess_3.png)

여기에 보면 이전에 소개했던 프로세스의 메모리 구조가 있는데,

여기서 스레드는 코드, 데이터, 힙 영역을 공통된 자원으로 사용을 합니다.

각 스레드는 스택 부분만을 따로 가지고 있는 것이죠 되게 효율적이에요. 공유 되는 자원이 있기 때문에 이전처럼 컨텍스트 스위칭이 일어날 때 캐싱 적중률이 올라갑니다

![process_4.png](..%2F..%2Fimages%2Fprocess_4.png)

# 2. Multi-Process VS Multi-Thread

멀티 프로세스와 멀티 스레드 두 가지 개념이 모두 처리방식의 일종입니다

단순히 여러 프로그램을 띄워 놓은 것을 멀티 프로세스라고 이야기 한다면 멀티 스레드란 개념과 비교를 해서 이해하기가 힘듭니다

예를 들어 여러 사용자가 로그인을 요청하는 상황이 있다고 합시다 한 프로세스는 매번 하나의 로그인만 처리할 수 있기 때문에 동시에 처리할 수 없어요

그래서 부모 프로세스가 fork()를 해서 자식 프로세스를 여러개 만들어서 일을 처리하도록 합니다

![process_5.png](..%2F..%2Fimages%2Fprocess_5.png)

이 때 자식 프로세스는 부모와 별개의 메모리 영역을 확보하게 되죠 반면 스레드는 한 프로세스 내에서 구분지어진 실행 단위예요

![thread_1.png](..%2F..%2Fimages%2Fthread_1.png)

초반에 언급했던 실행 단위는 이 단위가 프로세스 일 수도 있고 스레드 일 수도 있다고 했었는데, 만약에 프로세스가 다수의 스레드로 구분되어 있지 않으면 단일 스레드 하나로 프로세스가 실행됩니다

이때 실행 단위는 프로세스 하나가 됩니다.(더 자세히 말하면 하나인 스레드가 프로세스의 실행 단위가 되는 것)

프로세스 내에서 분리해서 여러 스레드로 나뉘어서 실행 다누이가 나뉘어지면 그게 멀티 스레드가 되는 거예요 그러니까 인텔리제이로 사용을 하면서  내가 코드를 수정하는 동시에  인텔리제이에서 추천코드도 보여줘야 하죠 테스트도 돌리는 도잇에 소스코드를 수정해야 될 때도 있어요

이렇게 한 어플리케이션에 대한 작업의 단위가 나누어질 때가 많아요

이때 각각의 스레드가 그 작업들을 담당하는 거예요

![process_thread.png](..%2F..%2Fimages%2Fprocess_thread.png)

멀티 프로세스는 각 프로세스마다 독립적이므로 자원을 개별적으로 사용하기 더 많은 자원과 메모리를 점유하기에 컨텍스트 스위칭 비용이 매우 비쌉니다. 하지만 개별 독립적이기 때문에 동기화 작업에 신경을 덜 써도 됩니다

반대로 스레드는 공유자원이 많으므로 서로 연결되어 있어서 프로세스에 비해 상대적으로 점유, 컨텍스트 스위칭의 비용이 적습니다. 허나 스레드끼리 자원을 공유하기 때문에 공유 자원 관리를 따로 해주어야 합니다

이렇게만 보면 멀티 프로세서보다 멀티 스레드가 훨씬 더 좋아보이는데 왜 멀티 프로세스를 이용할까요?

실생활로 예시를 들어보면

![example.png](..%2F..%2Fimages%2Fexample.png)

예전에 인터넷 익스플로러를 사용하다가 이러한 오류 화면을 만난 적이 한 번쯤 다들 있으시죠 이런 오류 화면을 만나면 혹시 잘못될까봐 마우스도 안움직이고 가만히 있다가 속으로 제발 세번쯤 외치면 창 전체가 꺼져버립니다 이 현상은 멀티스레드를 이용했기 때문이에요 긴밀하게 연결되어 있기 때문에 한 스레드, 한 탭에 문제가 생기면 전체 프로세스의 영향이 가죠 반면 구글 크롬은 다소 비효율적인 부분이 있을 수 있지만 멀티 프로세서를 이용 하기 때문에 멀티탭 간의 영향을 덜 받습니다

# 3. Multi-core

멀티 코어는 기존 멀티 프로세스와 멀티 스레드와는 다른 관점으로 이해해야 한다.

멀티 프로세스와 멀티 스레드는 결국 ‘처리 방식’의 일종(소프트웨어)으로 피자 만드는 직원이 피자를 만드는 “방법”을 바꾸는 것이기지만, 멀티 코어는 직원을 추가하는 것과 유사하다고 할 수 있습니다 따라서 하드웨어의 측면이라고 할 수 있겠습니다.

동시성은 만화 애니메이션 처럼 영상이 아니지만 하나하나의 그림을 매우 빠른 속도로 연속해서 재생하는 것으로 물체가 움직이는 것처럼 보이게 하는, 짧은 순간에 cpu의 시간을 분할해서 동시에 하는 것처럼 보이게 하는 것입니다

하지만 멀티코어는 병렬처리 물리적으로 여러 코어를 사용해서 다수의 실행 단위를 한순간에 처리할 수 있게 해준 거예요

![multi_core.png](..%2F..%2Fimages%2Fmulti_core.png)

## 번외) 리눅스에서 Process와 Thread

**리눅스 커널** 에서는 프로세스와 스레드를 동일하게 봅니다

하지만 이는 우리가 흔히 아는 프로세스와 스레드의 같은 개념이 아니고, 리눅스에서는 다르게 동작하기 때문에 성립하는 문장입니다